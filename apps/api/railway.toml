[build]
builder = "NIXPACKS"
buildCommand = "cd ../.. && npm install -g pnpm && pnpm install --frozen-lockfile && pnpm build"

[deploy]
startCommand = "cd apps/api && npm install -g pnpm && pnpm db migrate deploy && node dist/index.js"
numReplicas = 1
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 5

[deploy.healthcheck]
httpPath = "/health"
initialDelaySeconds = 30
periodSeconds = 10
timeoutSeconds = 5
successThreshold = 1
failureThreshold = 3